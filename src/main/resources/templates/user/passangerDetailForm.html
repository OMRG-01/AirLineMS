<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Passenger Details</title>

	<link rel="icon" type="image/png" th:href="@{/img/fg.png}">
	    <link rel="stylesheet" th:href="@{/css/home.css}">
	    <link rel="stylesheet" th:href="@{/css/autosearch.css}">
	    <link href="https://cdn.jsdelivr.net/npm/remixicon@3.4.0/fonts/remixicon.css" rel="stylesheet" />
	    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
	    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
	    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
	    <title>Flight Suggestions</title>
	    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css" rel="stylesheet">
	    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
	<style>
		:root {
		        --primary-color: #721b47;
		        --text-dark: #333;
		        --light-bg: #f8f9fa;
		        --border-color: #e0e6ed;
		        --success-color: #28a745;
		        --shadow-light: 0 2px 10px rgba(0,0,0,0.08);
		        --shadow-medium: 0 4px 20px rgba(0,0,0,0.12);
		        --border-radius: 12px;
		        }
			 body {
			            font-family: 'Poppins', sans-serif;
			            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
			            margin: 0;
			            padding: 0;
			            min-height: 100vh;
			        }
		        /* Header Styles - Preserved exactly as original */
		        header {
		        position: fixed;
		        top: 0;
		        left: 0;
			
		        width: 100%;
		        display: flex;
		        justify-content: space-between;
		        align-items: center;
		        transition: 0.6s;
		        padding: 10px 20px 0 30px;
		        z-index: 10000;
		        background: rgba(255, 255, 255, 0.95);
		        backdrop-filter: blur(10px);
		        box-shadow: 0 2px 20px rgba(0, 0, 0, 0.1);
		        }
		        header .logo {
		        font-weight: 700;
		        text-decoration: none;
		        font-size: 1.5rem;
		        text-transform: uppercase;
		        letter-spacing: 2px;
		        transition: 0.6s;
		        }
		        header ul {
		        display: flex;
		        justify-content: center;
		        align-items: center;
		        }
		        header ul li {
		        margin-right: 15px;
		        list-style: none;
		        }
		        header ul li:last-child {
		        margin-right: 0;
		        }
		        header ul li a {
		        margin: 0 15px;
		        text-decoration: none;
		        color: var(--primary-color);
		        letter-spacing: 2px;
		        font-weight: 700;
		        transition: 0.6s;
		        }
		        .nav__logo img {
		        height: 50px;
		        width: 150px;
		        margin-right: 10px;
		        }
		        .nav__links {
		        list-style: none;
		        display: flex;
		        align-items: center;
		        gap: 2rem;
		        }
		        .nav__links li {
		        list-style: none;
		        display: inline-block;
		        padding: 8px 12px;
		        position: relative;
		        font-family: 'Poppins', sans-serif;
		        }
		        .nav__links li a {
		        color: var(--text-dark);
		        text-decoration: none;
		        font-weight: 700;
		        font-family: 'Poppins', sans-serif;
		        }
		        .nav__links li::after {
		        content: '';
		        width: 0%;
		        height: 2px;
		        background: var(--primary-color);
		        display: block;
		        margin: auto;
		        transition: 0.5s;
		        }
		        .nav__links li:hover::after {
		        width: 80%;
		        }
		        .btn {
		        background: var(--primary-color);
		        color: white;
		        border: none;
		        padding: 10px 20px;
		        border-radius: 25px;
		        font-weight: 600;
		        transition: all 0.3s ease;
		        }
		        .btn:hover {
		        background: #8b2557;
		        transform: translateY(-2px);
		        box-shadow: 0 5px 15px rgba(114, 27, 71, 0.3);
		        }

		        /* Main Content Styles */
		        .main-container {
		            margin-top: 100px;
		            padding: 20px;
		            max-width: 1200px;
		            margin-left: auto;
		            margin-right: auto;
		        }

		        .page-title {
		            text-align: center;
		            color: var(--text-dark);
		            font-size: 2.5rem;
		            font-weight: 700;
		            margin-bottom: 10px;
		            background: linear-gradient(135deg, var(--primary-color), #8b2557);
		            -webkit-background-clip: text;
		            -webkit-text-fill-color: transparent;
		            background-clip: text;
		        }

		        .page-subtitle {
		            text-align: center;
		            color: #666;
		            font-size: 1.1rem;
		            margin-bottom: 40px;
		            font-weight: 400;
		        }

		        .passengers-container {
		            display: grid;
		            gap: 25px;
		            margin-bottom: 40px;
		        }

		        .passenger-card {
		            background: white;
		            border-radius: var(--border-radius);
		            box-shadow: var(--shadow-light);
		            padding: 30px;
		            transition: all 0.3s ease;
		            border: 2px solid transparent;
		            position: relative;
		            overflow: hidden;
		        }

		        .passenger-card::before {
		            content: '';
		            position: absolute;
		            top: 0;
		            left: 0;
		            right: 0;
		            height: 4px;
		            background: linear-gradient(90deg, var(--primary-color), #8b2557, #a0306e);
		        }

		        .passenger-card:hover {
		            transform: translateY(-5px);
		            box-shadow: var(--shadow-medium);
		            border-color: var(--primary-color);
		        }

		        .passenger-header {
		            display: flex;
		            align-items: center;
		            gap: 15px;
		            margin-bottom: 25px;
		            padding-bottom: 15px;
		            border-bottom: 2px solid var(--light-bg);
		        }

		        .passenger-icon {
		            width: 50px;
		            height: 50px;
		            background: linear-gradient(135deg, var(--primary-color), #8b2557);
		            border-radius: 50%;
		            display: flex;
		            align-items: center;
		            justify-content: center;
		            color: white;
		            font-size: 1.2rem;
		            font-weight: 600;
		        }

		        .passenger-title {
		            color: var(--text-dark);
		            font-size: 1.4rem;
		            font-weight: 600;
		            margin: 0;
		        }

		        .form-grid {
		            display: grid;
		            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
		            gap: 20px;
		        }

		        .form-group {
		            position: relative;
		        }

		        .form-label {
		            display: block;
		            color: var(--text-dark);
		            font-weight: 600;
		            margin-bottom: 8px;
		            font-size: 0.95rem;
		            display: flex;
		            align-items: center;
		            gap: 8px;
		        }

		        .form-label i {
		            color: var(--primary-color);
		            width: 16px;
		            text-align: center;
		        }

		        .form-control {
		            width: 100%;
		            padding: 12px 16px;
		            border: 2px solid var(--border-color);
		            border-radius: 8px;
		            font-size: 1rem;
		            font-family: 'Poppins', sans-serif;
		            transition: all 0.3s ease;
		            background: white;
		            box-sizing: border-box;
		        }

		        .form-control:focus {
		            outline: none;
		            border-color: var(--primary-color);
		            box-shadow: 0 0 0 3px rgba(114, 27, 71, 0.1);
		            transform: translateY(-1px);
		        }

		        .form-control:valid {
		            border-color: var(--success-color);
		        }

		        .form-select {
		            background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3e%3c/svg%3e");
		            background-position: right 12px center;
		            background-repeat: no-repeat;
		            background-size: 16px;
		            padding-right: 40px;
		            appearance: none;
		            cursor: pointer;
		        }

		        .continue-section {
		            text-align: center;
		            margin-top: 40px;
		            padding: 30px;
		            background: white;
		            border-radius: var(--border-radius);
		            box-shadow: var(--shadow-light);
		        }

		        .continue-btn {
		            background: linear-gradient(135deg, var(--primary-color), #8b2557);
		            color: white;
		            border: none;
		            padding: 16px 40px;
		            border-radius: 50px;
		            font-size: 1.1rem;
		            font-weight: 600;
		            cursor: pointer;
		            transition: all 0.3s ease;
		            display: inline-flex;
		            align-items: center;
		            gap: 10px;
		            text-transform: uppercase;
		            letter-spacing: 1px;
		            box-shadow: 0 4px 15px rgba(114, 27, 71, 0.3);
		        }

		        .continue-btn:hover {
		            transform: translateY(-3px);
		            box-shadow: 0 8px 25px rgba(114, 27, 71, 0.4);
		            background: linear-gradient(135deg, #8b2557, #a0306e);
		        }

		        .continue-btn:active {
		            transform: translateY(-1px);
		        }

		        /* Progress indicator */
		        .progress-steps {
		            display: flex;
		            justify-content: center;
		            align-items: center;
		            gap: 20px;
		            margin-bottom: 40px;
		            padding: 20px;
		            background: white;
		            border-radius: var(--border-radius);
		            box-shadow: var(--shadow-light);
		        }

		        .step {
		            display: flex;
		            align-items: center;
		            gap: 10px;
		            padding: 10px 20px;
		            border-radius: 25px;
		            font-weight: 600;
		            font-size: 0.9rem;
		        }

		        .step.completed {
		            background: var(--success-color);
		            color: white;
		        }

		        .step.active {
		            background: var(--primary-color);
		            color: white;
		        }

		        .step.pending {
		            background: var(--light-bg);
		            color: #666;
		        }

		        /* Responsive Design */
		        @media (max-width: 768px) {
		            .main-container {
		                padding: 15px;
		                margin-top: 80px;
		            }

		            .page-title {
		                font-size: 2rem;
		            }

		            .passenger-card {
		                padding: 20px;
		            }

		            .form-grid {
		                grid-template-columns: 1fr;
		                gap: 15px;
		            }

		            .progress-steps {
		                flex-wrap: wrap;
		                gap: 10px;
		            }

		            .step {
		                padding: 8px 16px;
		                font-size: 0.8rem;
		            }

		            .continue-btn {
		                padding: 14px 30px;
		                font-size: 1rem;
		            }

		            header {
		                padding: 10px 15px 0 20px;
		            }

		            .nav__links {
		                gap: 1rem;
		            }

		            .nav__links li a {
		                margin: 0 8px;
		                font-size: 0.9rem;
		            }
		        }

		        @media (max-width: 480px) {
		            .passenger-header {
		                flex-direction: column;
		                text-align: center;
		                gap: 10px;
		            }

		            .form-control {
		                padding: 10px 14px;
		            }

		            .nav__logo img {
		                height: 40px;
		                width: 120px;
		            }
		        }

		        /* Animation for form validation */
		        @keyframes shake {
		            0%, 100% { transform: translateX(0); }
		            25% { transform: translateX(-5px); }
		            75% { transform: translateX(5px); }
		        }

		        .form-control.error {
		            border-color: #dc3545;
		            animation: shake 0.5s ease-in-out;
		        }

		        .error-message {
		            color: #dc3545;
		            font-size: 0.85rem;
		            margin-top: 5px;
		            display: none;
		        }
	</style>
   
</head>
<body>
	<!-- Header - Preserved exactly as original -->
	<header>
	   <div class="nav__logo"><img th:src="@{/assets/jetsetflylogo.png}" alt="JetSetFly Logo"></div>
	   <ul class="nav__links">
	      <li class="link"><a th:href="@{/user/userDash}">HOME</a></li>
	      <li class="link"><a th:href="@{/user/bookings}">MY FLIGHTS</a></li>
	      <li class="link"><a th:href="@{/user/review}">REVIEW</a></li>
	      <li class="link"><a th:href="@{/user/profileEdit}">Profile</a></li>
	   </ul>
	   <a th:href="@{/user/logout}"><button class="btn">Login &nbsp;<i class="fa fa-sign-in" style="font-size:15px"></i></button></a>
	</header>

	<div class="main-container">
	    <h1 class="page-title">Passenger Details</h1>
	    <p class="page-subtitle">Please provide accurate information for all passengers</p>

	    <!-- Progress Steps -->
	    <div class="progress-steps">
	        <div class="step completed">
	            <i class="fas fa-search"></i>
	            <span>Search Flights</span>
	        </div>
	        <div class="step completed">
	            <i class="fas fa-plane"></i>
	            <span>Select Flight</span>
	        </div>
	        <div class="step active">
	            <i class="fas fa-users"></i>
	            <span>Passenger Details</span>
	        </div>
	        <div class="step pending">
	            <i class="fas fa-credit-card"></i>
	            <span>Payment</span>
	        </div>
	    </div>

	    <div class="passengers-container">
	        <div th:each="i : ${#numbers.sequence(1, nos_passanger)}" class="passenger-card passenger-form">
	            <div class="passenger-header">
	                <div class="passenger-icon">
	                    <span th:text="${i}">1</span>
	                </div>
	                <h3 class="passenger-title">Passenger [[${i}]]</h3>
	            </div>

	            <input type="hidden" name="userId" th:value="${userId}" />
	            
	            <div class="form-grid">
	                <div class="form-group">
	                    <label class="form-label" for="pname[[${i}]]">
	                        <i class="fas fa-user"></i>
	                        Full Name
	                    </label>
	                    <input type="text" 
	                           name="pname" 
	                           id="pname[[${i}]]" 
	                           class="form-control" 
	                           placeholder="Enter full name as per ID"
	                           required />
	                    <div class="error-message">Please enter a valid name</div>
	                </div>

	                <div class="form-group">
	                    <label class="form-label" for="mobileNo[[${i}]]">
	                        <i class="fas fa-phone"></i>
	                        Mobile Number
	                    </label>
	                    <input type="tel" 
	                           name="mobileNo" 
	                           id="mobileNo[[${i}]]" 
	                           class="form-control" 
	                           placeholder="Enter 10-digit mobile number"
	                           pattern="[0-9]{10}"
	                           required />
	                    <div class="error-message">Please enter a valid 10-digit mobile number</div>
	                </div>

	                <div class="form-group">
	                    <label class="form-label" for="dob[[${i}]]">
	                        <i class="fas fa-calendar-alt"></i>
	                        Date of Birth
	                    </label>
	                    <input type="date" 
	                           name="dob" 
	                           id="dob[[${i}]]" 
	                           class="form-control" 
	                           required />
	                    <div class="error-message">Please select a valid date of birth</div>
	                </div>

	                <div class="form-group">
	                    <label class="form-label" for="gender[[${i}]]">
	                        <i class="fas fa-venus-mars"></i>
	                        Gender
	                    </label>
	                    <select name="gender" 
	                            id="gender[[${i}]]" 
	                            class="form-control form-select" 
	                            required>
	                        <option value="">Select Gender</option>
	                        <option value="Male">Male</option>
	                        <option value="Female">Female</option>
	                        <option value="Other">Other</option>
	                    </select>
	                    <div class="error-message">Please select a gender</div>
	                </div>
	            </div>
	        </div>
	    </div>

	    <div class="continue-section">
	        <button type="button" class="continue-btn" onclick="continueToPay()">
	            Continue to Payment
	            <i class="fas fa-arrow-right"></i>
	        </button>
	    </div>
	</div>

	<script>
	   function continueToPay() {
	       let passengers = [];
	       let hasErrors = false;

	       // Clear previous errors
	       document.querySelectorAll('.form-control').forEach(input => {
	           input.classList.remove('error');
	           input.nextElementSibling.style.display = 'none';
	       });

	       document.querySelectorAll('.passenger-form').forEach(form => {
			let userId = form.querySelector('input[name="userId"]').value;
			let pname = form.querySelector('input[name="pname"]').value.trim();
			let mobileNo = form.querySelector('input[name="mobileNo"]').value.trim();
			let dob = form.querySelector('input[name="dob"]').value;
			let gender = form.querySelector('select[name="gender"]').value;

	           // Validation
	           if (!pname) {
	               showError(form.querySelector('input[name="pname"]'));
	               hasErrors = true;
	           }

	           if (!mobileNo || !/^[0-9]{10}$/.test(mobileNo)) {
	               showError(form.querySelector('input[name="mobileNo"]'));
	               hasErrors = true;
	           }

	           if (!dob) {
	               showError(form.querySelector('input[name="dob"]'));
	               hasErrors = true;
	           }

	           if (!gender) {
	               showError(form.querySelector('select[name="gender"]'));
	               hasErrors = true;
	           }

	           if (!hasErrors) {
	               passengers.push({
	                   pname: pname,
	                   mobileNo: mobileNo,
	                   dob: dob,
	                   gender: gender,
					userId: userId
	               });
	           }
	       });

	       if (hasErrors) {
	           // Smooth scroll to first error
	           const firstError = document.querySelector('.form-control.error');
	           if (firstError) {
	               firstError.scrollIntoView({ behavior: 'smooth', block: 'center' });
	           }
	           return;
	       }

	       // Show loading state
	       const continueBtn = document.querySelector('.continue-btn');
	       const originalHTML = continueBtn.innerHTML;
	       continueBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Processing...';
	       continueBtn.disabled = true;

	       fetch('/api/temp-save-connected', {
	           method: 'POST',
	           headers: { 'Content-Type': 'application/json' },
	           body: JSON.stringify(passengers)
	       }).then(response => {
	           if (response.ok) {
	               window.location.href = '/user/gateway2';
	           } else {
	               throw new Error('Failed to save passenger details');
	           }
	       }).catch(err => {
	           console.error(err);
	           alert("Failed to save passenger details. Please try again.");
	           // Restore button
	           continueBtn.innerHTML = originalHTML;
	           continueBtn.disabled = false;
	       });
	   }

	   function showError(element) {
	       element.classList.add('error');
	       const errorMessage = element.nextElementSibling;
	       if (errorMessage && errorMessage.classList.contains('error-message')) {
	           errorMessage.style.display = 'block';
	       }
	   }

	   // Real-time validation
	   document.addEventListener('DOMContentLoaded', function() {
	       document.querySelectorAll('.form-control').forEach(input => {
	           input.addEventListener('input', function() {
	               if (this.value.trim()) {
	                   this.classList.remove('error');
	                   const errorMessage = this.nextElementSibling;
	                   if (errorMessage && errorMessage.classList.contains('error-message')) {
	                       errorMessage.style.display = 'none';
	                   }
	               }
	           });
	       });
	   });
	</script>
</body>
</html>