<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <title>My Flights</title>
    <link rel="icon" type="image/png" th:href="@{/img/fg.png}">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css"
        integrity="sha384-JcKb8q3iqJ61gNV9KGb8thSsNjpSL0n8PARn9HuZOnIxN0hoP+VmmDGMN5t9UJ0Z" crossorigin="anonymous">
    <link href="https://cdn.jsdelivr.net/npm/remixicon@3.4.0/fonts/remixicon.css" rel="stylesheet" />
	<link href="https://cdn.jsdelivr.net/npm/remixicon@3.4.0/fonts/remixicon.css" rel="stylesheet" />
			<link rel="icon" type="image/png" th:href="@{/img/fg.png}">
	    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
	    <script src="https://kit.fontawesome.com/44f557ccce.js"></script>
    <script src="https://kit.fontawesome.com/44f557ccce.js"></script>
    <style>
        @import url("https://fonts.googleapis.com/css?family=Poppins:200,300,400,500,600,700,800,900&display=swap");

        :root {
            --primary-color: #8E2157;
            --primary-color-dark: #6b0f3d;
            --text-dark: #0b0f18;
            --text-light: #503744;
            --extra-light: #f1f5f9;
            --white: #ffffff;
            --max-width: 1400px;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Poppins', sans-serif;
        }

        body {
            background-color: var(--extra-light);
            padding-bottom: 100px; /* Space for fixed footer */
        }

        /*-----------------HEADER------------------------*/
        header {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: 0.6s;
            padding: 10px 20px 0 30px;
            z-index: 10000;
            background-color: var(--white);
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        header .logo {
            font-weight: 700;
            color: white;
            text-decoration: none;
            font-size: 1.5rem;
            text-transform: uppercase;
            letter-spacing: 2px;
            transition: 0.6s;
        }

        header ul {
            display: flex;
            justify-content: center;
            align-items: center;
        }

        header ul li {
            margin-right: 15px;
            list-style: none;
        }

        header ul li:last-child {
            margin-right: 0;
        }

        header ul li a {
            margin: 0 15px;
            text-decoration: none;
            color: var(--primary-color);
            letter-spacing: 2px;
            font-weight: 700;
            transition: 0.6s;
            background: #fff;
        }

        .nav__logo img {
            height: 50px;
            width: 150px;
            margin-right: 10px;
        }

        .nav__links {
            list-style: none;
            display: flex;
            align-items: center;
            gap: 2rem;
        }

        .nav__links li {
            list-style: none;
            display: inline-block;
            padding: 8px 12px;
            position: relative;
            font-family: 'Poppins', sans-serif;
        }

        .nav__links li a {
            color: var(--text-dark);
            text-decoration: none;
            font-weight: 700;
            font-family: 'Poppins', sans-serif;
        }

        .nav__links li::after {
            content: '';
            width: 0%;
            height: 3px;
            background: var(--primary-color);
            display: block;
            margin: auto;
            transition: 0.5s;
        }

        .nav__links li:hover::after {
            width: 80%;
        }

        .btn {
            padding: 0.75rem 2rem;
            outline: none;
            border: none;
            font-size: 1rem;
            font-weight: 500;
            color: var(--white);
            background-color: var(--primary-color);
            border-radius: 2rem;
            cursor: pointer;
            transition: 0.3s;
        }

        .btn a {
            color: var(--extra-light);
            text-decoration: none;
        }
        
        .btn a:hover {
            color: var(--extra-light);
            text-decoration: none;
        }
        
        .btn:hover {
            background-color: var(--primary-color-dark);
        }

        /*--------------------FOOTER CSS------------------*/
		.footer {
		    position: fixed;
		    bottom: 0;
		    width: 100%;
		    background-color: var(--primary-color);
		    padding: 20px 0;
		    z-index: 1000;
		    transform: translateY(100%);
		    transition: transform 0.3s ease-in-out;
		}


        .footer__bar1 {
            padding: 0 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 1rem;
        }

        .footer__bar1 p {
            font-size: 0.9rem;
            color: white;
            padding: 0 80px;
        }

        .social {
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        
        .text-muted i {
            font-size: 1.3rem;
            color: white;
        }

        .social span {
            font-size: 1.2rem;
            color: var(--extra-light);
        }

        .social span a {
            text-decoration: none;
            color: var(--extra-light);
        }

        .n_logo {
            display: flex;
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--text-dark);
        }

        .n_logo img {
            height: 50px;
            width: 150px;
            margin-right: 10px;
        }

        /* ---------- FLIGHT CARD STYLING ---------- */
        .page-title {
            text-align: center;
            margin-top: 100px;
            margin-bottom: 30px;
            color: var(--primary-color);
        }

        .flights-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 100%;
            padding: 0 20px;
        }

        .flight-card {
            width: 80%;
            background-color: white;
            border-radius: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            margin-bottom: 30px;
            position: relative;
            overflow: hidden;
        }

        .flight-card-header {
            background-color: var(--primary-color);
            color: white;
            padding: 10px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .flight-card-header h4 {
            margin: 0;
            font-weight: 600;
        }

        .flight-status {
            font-size: 0.9rem;
            padding: 5px 10px;
            border-radius: 15px;
            background-color: rgba(255, 255, 255, 0.2);
        }

        .flight-card-body {
            padding: 20px;
            display: flex;
        }

        .flight-details {
            flex: 3;
            padding-right: 20px;
        }

        .flight-route {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .flight-city {
            text-align: center;
        }

        .flight-city h2 {
            margin: 0;
            font-weight: 700;
        }

        .flight-city p {
            margin: 0;
            color: var(--text-light);
        }

		.flight-path {
		           position: relative;
		           display: flex;
		           align-items: center;
		           width: 45%;
		           margin: 20px 0;
		       }

		       .flight-path hr {
		           flex-grow: 1;
		           height: 2px;
		           background-color: var(--primary-color);
		           border: none;
		       }

		       .flight-path .origin-dot {
		           width: 10px;
		           height: 10px;
		           background-color: var(--primary-color);
		           border-radius: 50%;
		           margin-right: 10px;
		       }

		       .flight-path i {
		           color: var(--primary-color);
		           margin: 0 5px;
		       }

        .flight-times {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
        }

        .time-box {
            text-align: center;
        }

        .time-box h3 {
            margin: 0;
            font-weight: 600;
        }

        .time-box p {
            margin: 0;
            color: var(--text-light);
            font-size: 0.9rem;
        }

        .flight-info {
            flex: 1;
            border-left: 1px solid #eee;
            padding-left: 20px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        .airline-info {
            text-align: center;
            margin-bottom: 20px;
        }

        .airline-info h4 {
            margin: 0;
            font-weight: 600;
            color: var(--primary-color);
        }

        .airline-info p {
            margin: 5px 0 0;
            font-size: 0.9rem;
            color: var(--text-light);
        }

        .action-buttons {
            display: flex;
            flex-direction: column;
            gap: 15px;
            width: 100%;
        }

        .btn-action {
            padding: 10px 15px;
            border-radius: 10px;
            font-weight: 600;
            text-align: center;
            text-decoration: none;
            display: inline-block;
            transition: all 0.3s ease;
            border: none;
            width: 100%;
        }

        .btn-boarding {
            background-color: var(--primary-color);
            color: white;
        }

        .btn-boarding:hover {
            background-color: var(--primary-color-dark);
            color: white;
            text-decoration: none;
        }

        .btn-cancel {
            background-color: #e74c3c;
            color: white;
        }

        .btn-cancel:hover {
            background-color: #c0392b;
            color: white;
            text-decoration: none;
        }

        .btn-disabled {
            background-color: #95a5a6;
            color: white;
            cursor: not-allowed;
        }

        /* No flights message */
        .no-flights {
            background-color: white;
            padding: 30px;
            border-radius: 20px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            width: 60%;
            margin: 50px auto;
        }

        .no-flights h3 {
            color: var(--primary-color);
            margin-bottom: 20px;
        }

        .no-flights a {
            color: var(--primary-color);
            font-weight: 600;
        }
    </style>
</head>

<body>
    <header>
        <div class="nav__logo"><img th:src="@{/assets/jetsetflylogo.png}" alt="JetSetFly Logo"></div>
        <ul class="nav__links">
            <li class="link"><a th:href="@{/user/userDash}">HOME</a></li>
            <li class="link"><a th:href="@{/user/bookings}">MY FLIGHTS</a></li>
            <li class="link"><a th:href="@{/user/review}">REVIEW</a></li>
        </ul>
        <a th:href="@{/login1}"><button class="btn">Login &nbsp;<i class="fa fa-sign-in" style="font-size:15px"></i></button></a>
    </header>

    <h1 class="page-title">My Flights</h1>

    <div class="flights-container">
        <!-- If no flights are booked, show this message -->
        <div th:if="${#lists.isEmpty(bookings)}" class="no-flights">
            <h3>You haven't booked any flights yet!</h3>
            <p>Browse our available flights and start your journey with JetSetFly.</p>
            <a th:href="@{/user/userDash}" class="btn btn-action btn-boarding">Book a Flight</a>
        </div>

        <!-- Loop through each booking to create flight cards -->
        <div th:each="booking : ${bookings}" class="flight-card">
            <div class="flight-card-header">
                <h4>Flight Details</h4>
                <!-- You can add status indicators here if needed -->
                <span class="flight-status" th:text="${#temporals.format(booking.schedule.departAt, 'dd MMM yyyy')}"></span>
            </div>

            <div class="flight-card-body">
                <div class="flight-details">
                    <div class="flight-route">
                        <div class="flight-city">
                            <h2 th:text="${booking.schedule.source.cityname}"></h2>
                            <p>Departure</p>
                        </div>
                        
						<!-- BEFORE departure -->
						<div class="flight-path" th:if="${booking.schedule.departAt.isAfter(now)}">
						    <div class="origin-dot"></div>
						    <i class="fa fa-fighter-jet fa-2x"></i>
						    <hr>
						    <hr>
						</div>

						<!-- IN FLIGHT -->
						<div class="flight-path"
						     th:if="${!booking.schedule.departAt.isAfter(now) and booking.schedule.arriveAt.isAfter(now)}">
						    <div class="origin-dot"></div>
						    <hr>
						    <i class="fa fa-fighter-jet fa-2x"></i>
						    <hr>
						</div>

						<!-- AFTER Arrival -->
						<div class="flight-path"
						     th:if="${!booking.schedule.arriveAt.isAfter(now)}">
						    <div class="origin-dot"></div>
						    <hr>
						    <hr>
						    <i class="fa fa-fighter-jet fa-2x"></i>
						</div>

                        
                        <div class="flight-city">
                            <h2 th:text="${booking.schedule.destination.cityname}"></h2>
                            <p>Arrival</p>
                        </div>
                    </div>

                    <div class="flight-times">
                        <div class="time-box">
                            <h3 th:text="${#temporals.format(booking.schedule.departAt, 'HH:mm')}"></h3>
                            <p th:text="${#temporals.format(booking.schedule.departAt, 'EEE, dd MMM')}"></p>
                        </div>
                        
                        <div class="time-box">
                            <h3 th:text="${#temporals.format(booking.schedule.arriveAt, 'HH:mm')}"></h3>
                            <p th:text="${#temporals.format(booking.schedule.arriveAt, 'EEE, dd MMM')}"></p>
                        </div>
                    </div>
                </div>

                <div class="flight-info">
                    <div class="airline-info">
                        <h4 th:text="${booking.airline.aname}"></h4>
                        <p th:text="${booking.flight.fnumber}"></p>
                    </div>
                    
                    <div class="action-buttons">
                        <a th:href="@{/booking/passengerView(bookingId=${booking.id})}" class="btn-action btn-boarding">
                            Boarding Pass
                        </a>
                        
                        <!-- 
                        Conditional Cancel button:
                        - If current time is less than 1 hour before departure, show active cancel button
                        - Otherwise show disabled button
                        -->
                        <a th:if="${#temporals.createNow().plusHours(1).isBefore(booking.schedule.departAt)}"
                           th:href="@{/booking/cancel(bookingId=${booking.id})}" 
                           class="btn-action btn-cancel">
                            Cancel Ticket
                        </a>
                        <span th:unless="${#temporals.createNow().plusHours(1).isBefore(booking.schedule.departAt)}"
                              class="btn-action btn-disabled" 
                              title="Cannot cancel within 1 hour of departure">
                            Cancel Unavailable
                        </span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <footer class="footer">
        <div class="section__container footer__bar1">
            <p>Copyright Â© 2024 Team GMADS. All rights reserved.</p>
            <div class="social">
                <span><a href="" class="text-muted" target="_blank"><i class="ri-facebook-fill"></i></a></span>
                <span><a href="" class="text-muted" target="_blank"><i class="ri-twitter-fill"></i></a></span>
                <span><a href="" class="text-muted" target="_blank"><i class="ri-instagram-line"></i></a></span>
                <span><a href="https://www.youtube.com/channel/UCNCWGkiAKDhwgCuGT02aXCg" class="text-muted"
                        target="_blank"><i class="ri-youtube-fill"></i></a></span>
                <div class="n_logo"><img th:src="@{/assets/w.png}" alt="Logo"></div>
            </div>
        </div>
    </footer>

    <!-- Add jQuery and Bootstrap JS for any interactive elements -->
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>